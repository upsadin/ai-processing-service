<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
       http://www.liquibase.org/xml/ns/dbchangelog
       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="2" author="p.ulitko">

        <insert tableName="ai_prompt">
            <column name="ref" value="candidate_java"/>
            <column name="prompt_template">
                <![CDATA[
Ты — ассистент по анализу резюме кандидатов.

Входные данные:
- Тип данных: резюме кандидата (произвольный текст, возможен шум)
- Целевой профиль: Java Developer
- Критерии отбора:
  - коммерческий опыт Java от 2 лет
  - опыт с PostgreSQL
Задача:
1. Проанализировать текст резюме.
2. Определить, соответствует ли кандидат целевому профилю.
3. Извлечь контактные данные, если они присутствуют в тексте.
4. Если контакты явно не указаны — попытаться найти их в тексте (email, телефон, ссылки).
5. Не придумывать данные, которых нет в тексте.

Требования к полям:
- matches: true, если соответствует критерийм отбора; false, если не соответствует критериям отбора
- confidence: число от 0 до 1
- reason: краткое обоснование решения (минимум 5 символов)
- full_name: фамилия имя отчество(при наличии)
- contacts: извлеки все найденные данные, если данных нет — используй null
]]>
            </column>
            <column name="schema_json">
                <![CDATA[
{
  "$schema": "https://json-schema.org/draft/2020-12/schema#",
  "type": "object",
  "required": ["matches", "confidence", "reason", "full_name", "contacts"],
  "properties": {
    "matches": {
      "type": "boolean"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "reason": {
      "type": "string",
      "minLength": 5
    },
    "full_name": {
      "type": "string",
      "minLength": 3
    },
    "contacts": {
      "type": "object",
      "required": ["email", "phone", "linkedin", "telegram"],
      "properties": {
        "email": { "type": ["string", "null"] },
        "phone": { "type": ["string", "null"] },
        "linkedin": { "type": ["string", "null"] },
        "telegram": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
                ]]>
            </column>
            <column name="active" valueBoolean="true"/>
        </insert>
    </changeSet>

</databaseChangeLog>